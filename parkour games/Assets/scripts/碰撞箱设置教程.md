# Unity碰撞箱与贴图大小匹配教程

## 方法一：自动调整碰撞箱大小（推荐）

### 使用SpriteRenderer自动调整
1. **选择方块对象**
   - 在Hierarchy中选择您的方块

2. **添加BoxCollider2D**
   - Add Component → Box Collider 2D

3. **自动调整大小**
   - 在BoxCollider2D组件中
   - 点击右上角的齿轮图标 ⚙️
   - 选择 "Reset" 或 "自动调整大小"
   - 或者直接点击 "Size" 旁边的 "Auto" 按钮

### 使用代码自动调整
```csharp
// 在脚本中自动调整碰撞箱大小
void Start()
{
    SpriteRenderer spriteRenderer = GetComponent<SpriteRenderer>();
    BoxCollider2D boxCollider = GetComponent<BoxCollider2D>();
    
    if (spriteRenderer != null && boxCollider != null)
    {
        // 获取Sprite的边界大小
        Vector2 spriteSize = spriteRenderer.sprite.bounds.size;
        
        // 设置碰撞箱大小为Sprite大小
        boxCollider.size = spriteSize;
    }
}
```

## 方法二：手动精确调整

### 查看Sprite尺寸
1. **选择Sprite**
   - 在Project面板中找到您的Sprite
   - 选中后在Inspector中查看尺寸信息

2. **记录尺寸**
   - 注意Sprite的Width和Height值
   - 或者查看Bounds Size

### 设置碰撞箱大小
1. **选择方块对象**
   - 在Hierarchy中选择方块

2. **调整BoxCollider2D**
   - 在BoxCollider2D组件中
   - 设置Size参数为Sprite的实际尺寸
   - 例如：如果Sprite是64x64像素，设置Size为(1,1)
   - 如果Sprite是128x64像素，设置Size为(2,1)

## 方法三：使用PolygonCollider2D（复杂形状）

### 适用于不规则形状
1. **添加PolygonCollider2D**
   - Add Component → Polygon Collider 2D

2. **自动生成碰撞形状**
   - PolygonCollider2D会自动根据Sprite的透明区域生成碰撞形状
   - 适合不规则形状的Sprite

3. **手动调整顶点**
   - 在Scene视图中可以看到碰撞形状的顶点
   - 可以手动调整顶点位置

## 方法四：使用代码动态调整

### 创建自动调整脚本
```csharp
using UnityEngine;

public class AutoColliderSize : MonoBehaviour
{
    [Header("碰撞箱设置")]
    [SerializeField] private bool autoSize = true;
    [SerializeField] private Vector2 sizeMultiplier = Vector2.one;
    [SerializeField] private Vector2 offset = Vector2.zero;
    
    private SpriteRenderer spriteRenderer;
    private BoxCollider2D boxCollider;
    
    void Start()
    {
        spriteRenderer = GetComponent<SpriteRenderer>();
        boxCollider = GetComponent<BoxCollider2D>();
        
        if (autoSize)
        {
            AdjustColliderSize();
        }
    }
    
    void AdjustColliderSize()
    {
        if (spriteRenderer != null && boxCollider != null)
        {
            // 获取Sprite的边界大小
            Vector2 spriteSize = spriteRenderer.sprite.bounds.size;
            
            // 应用缩放和偏移
            Vector2 finalSize = new Vector2(
                spriteSize.x * sizeMultiplier.x,
                spriteSize.y * sizeMultiplier.y
            );
            
            // 设置碰撞箱大小
            boxCollider.size = finalSize;
            
            // 设置偏移
            boxCollider.offset = offset;
        }
    }
    
    // 公共方法，供其他脚本调用
    public void SetSizeMultiplier(Vector2 multiplier)
    {
        sizeMultiplier = multiplier;
        AdjustColliderSize();
    }
    
    public void SetOffset(Vector2 newOffset)
    {
        offset = newOffset;
        AdjustColliderSize();
    }
    
    // 在编辑器中调用
    [ContextMenu("调整碰撞箱大小")]
    void AdjustSizeInEditor()
    {
        AdjustColliderSize();
    }
}
```

## 方法五：批量调整多个方块

### 创建批量调整脚本
```csharp
using UnityEngine;

public class BatchColliderAdjuster : MonoBehaviour
{
    [Header("批量调整设置")]
    [SerializeField] private bool adjustOnStart = true;
    [SerializeField] private Vector2 globalSizeMultiplier = Vector2.one;
    
    void Start()
    {
        if (adjustOnStart)
        {
            AdjustAllChildren();
        }
    }
    
    void AdjustAllChildren()
    {
        // 获取所有子对象
        Transform[] children = GetComponentsInChildren<Transform>();
        
        foreach (Transform child in children)
        {
            if (child != transform) // 排除自己
            {
                AdjustSingleObject(child.gameObject);
            }
        }
    }
    
    void AdjustSingleObject(GameObject obj)
    {
        SpriteRenderer spriteRenderer = obj.GetComponent<SpriteRenderer>();
        BoxCollider2D boxCollider = obj.GetComponent<BoxCollider2D>();
        
        if (spriteRenderer != null && boxCollider != null)
        {
            Vector2 spriteSize = spriteRenderer.sprite.bounds.size;
            boxCollider.size = spriteSize * globalSizeMultiplier;
        }
    }
    
    [ContextMenu("批量调整所有子对象")]
    void AdjustAllInEditor()
    {
        AdjustAllChildren();
    }
}
```

## 实用技巧

### 1. 检查碰撞箱是否匹配
```csharp
void OnDrawGizmos()
{
    // 在Scene视图中显示碰撞箱
    BoxCollider2D boxCollider = GetComponent<BoxCollider2D>();
    if (boxCollider != null)
    {
        Gizmos.color = Color.red;
        Gizmos.DrawWireCube(transform.position + (Vector3)boxCollider.offset, boxCollider.size);
    }
}
```

### 2. 考虑Transform缩放
```csharp
void AdjustColliderWithScale()
{
    SpriteRenderer spriteRenderer = GetComponent<SpriteRenderer>();
    BoxCollider2D boxCollider = GetComponent<BoxCollider2D>();
    
    if (spriteRenderer != null && boxCollider != null)
    {
        Vector2 spriteSize = spriteRenderer.sprite.bounds.size;
        Vector3 scale = transform.localScale;
        
        // 考虑Transform的缩放
        boxCollider.size = new Vector2(
            spriteSize.x * scale.x,
            spriteSize.y * scale.y
        );
    }
}
```

### 3. 处理不同像素密度的Sprite
```csharp
void AdjustForPixelDensity()
{
    SpriteRenderer spriteRenderer = GetComponent<SpriteRenderer>();
    BoxCollider2D boxCollider = GetComponent<BoxCollider2D>();
    
    if (spriteRenderer != null && boxCollider != null)
    {
        Sprite sprite = spriteRenderer.sprite;
        Vector2 spriteSize = sprite.bounds.size;
        
        // 根据像素密度调整
        float pixelsPerUnit = sprite.pixelsPerUnit;
        Vector2 adjustedSize = spriteSize * (100f / pixelsPerUnit);
        
        boxCollider.size = adjustedSize;
    }
}
```

## 常见问题解决

### 碰撞箱太大或太小
- 检查Transform的Scale值
- 确认Sprite的Pixels Per Unit设置
- 调整sizeMultiplier参数

### 碰撞箱位置不对
- 检查BoxCollider2D的Offset设置
- 确认Sprite的Pivot点设置
- 调整碰撞箱偏移

### 不规则形状碰撞问题
- 考虑使用PolygonCollider2D
- 或者手动调整BoxCollider2D的Size
- 对于复杂形状，可能需要多个碰撞器

## 最佳实践

1. **优先使用自动调整**
   - 大多数情况下，Unity的自动调整功能就足够了

2. **测试碰撞效果**
   - 在Scene视图中启用碰撞箱显示
   - 运行游戏测试碰撞是否准确

3. **考虑性能**
   - 对于大量对象，使用代码批量调整
   - 避免在运行时频繁调整碰撞箱

4. **保存设置**
   - 调整完成后保存场景
   - 考虑创建预制体以便重复使用 